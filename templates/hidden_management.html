{% extends 'base.html' %}

{% block title %}DMD Panel Administratora - Zarządzanie Kampaniami Anonimowymi{% endblock %}

{% block addButton %}

    <li style="margin-left: 15px;">
        <a  data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"><i class="bi bi-plus-square-fill" style="font-size: 18pt; color: rgb(14, 144, 14) !important;"></i></a>
    </li>
{% endblock %}
{% block navbarTitle %}<a class="nav-link active dark-mode " aria-current="page" href="#">Zarządzanie Kampaniami Anonimowymi</a>{% endblock %}

{% block tableHeader %}
                        <div>
                            <div class="row klej formatuj-header">
                                <div class="d-none d-lg-block" style="max-width: 30px;">
                                    #
                                </div>
                                <div  class="col-xl-8 col-lg-6 col-sm-8">
                                    Tytuł
                                </div>
                                <div  class="d-none d-lg-block" style="max-width: 120px;">
                                    Autor Kampanii
                                </div>
                                <div  class="d-none d-xl-block" style="max-width: 150px;">
                                    Kategoria
                                </div>
                                <div  class="d-none d-lg-block" style="max-width: 120px;">
                                    Status
                                </div>
                                <div  class="d-none d-xl-block" style="max-width: 250px;">
                                    Aktywność
                                </div>
                                <div  class="d-none d-lg-block" style="max-width: 150px;">
                                    Data publikacji
                                </div>
                                <div  class="text-end" style="max-width: 80px;">
                                    <i class="bi bi-person-gear"></i> Akcja 
                                </div>
                            </div>
                        </div>
{% endblock %}
{% block tableContent%}
                        <!-- OFFCANVANSE RIGHT ADD NEW POST -->
                        <div class="offcanvas offcanvas-end bg-dark oc-width" tabindex="-1" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
                            <div class="offcanvas-header">
                                <h4 class="offcanvas-title" id="offcanvasRightLabel">Dodawanie nowej kampanii anonimowej.</h4>
                                <button type="button" class="btn-close btn-close-white"  data-bs-dismiss="offcanvas" aria-label="Close"></button>
                            </div>
                            <div class="offcanvas-body">
                                <form method="POST" id="hiddencampaigns_9999999" action="{{ url_for('save_hidden_campaigns') }}" enctype="multipart/form-data" >
                                <!-- <form method="POST" action="/save-hidden-campaigns"> -->
                                    <!-- title -->
                                    <div class="form-floating mb-3">
                                        <input 
                                            type="text" 
                                            value=""
                                            class="form-control bg-dark formatuj-maly-font" 
                                            style="color:#c2c2c2; border:#6a6a6a solid 1px;"
                                            id="title_9999999" 
                                            name="title" 
                                            placeholder="Tytuł Kampanii"
                                            required />
                                        <label for="title_9999999">Tytuł Kampanii</label>
                                    </div>
                                    <!-- description -->
                                    <label class="form-label mt-2">Treść ogłoszenia</label>
                                    <div 
                                        id="description_9999999" 
                                        contenteditable="true" 
                                        class="form-control bg-dark formatuj-maly-font" 
                                        style="color:#c2c2c2; border:#6a6a6a solid 1px; padding:10px; min-height:100px;">
                                    </div>
                                    <div class="no-border formatuj-maly-font fadeIn mb-3">
                                        <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_9999999', 'Szukamy [stanowisko]. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                            Szablon Ogólny
                                        </a>
                                        <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_9999999', 'Szukamy [stanowisko] z doświadczeniem w branży minimum [ilość lat] lat. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                            Szablon Zadaniowiec
                                        </a>
                                        <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_9999999', 'Szukamy Lidera Zespołu [rodzaj zespołu] z doświadczeniem w zarządzaniu. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                            Szablon Lider Zespołu
                                        </a>
                                        <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_9999999', 'Szukamy Eksperta Specjalistycznego w dziedzinie [dziedzina]. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                            Szablon Ekspert Specjalistyczny
                                        </a>
                                        <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_9999999', 'Szukamy ekipy budowlanej z doświadczeniem. Oferujemy stałe zlecenia, dobre wynagrodzenie. Kontakt: [forma kontaktu].');">
                                            Szablon Ekipa Budowlana
                                        </a>
                                    </div>
                                    
                                    <!-- category -->
                                    <div class="mb-3">
                                        <select 
                                            class="form-select dark-mode mb-2 mt-2" 
                                            style="max-height: 30px; font-size: 12px;" 
                                            id="category_9999999" 
                                            name="category"
                                            required>

                                            <option value="">Kategoria grupy</option>
                                            <option value="budowy">Budowy</option>
                                            <option value="murarze">Murarze</option>
                                            <option value="domy">Budowa domów</option>
                                            <option value="ciesle">Cieśle</option>
                                            <option value="szalunkowcy">Szalunkowcy</option>
                                            <option value="dekarze">Dekarze</option>
                                            <option value="ocieplenia">Ocieplenia</option>
                                            <option value="ekipy">Ekipy budowlane</option>
                                            <option value="praca">Praca</option>
                                            <option value="zagranica">Praca za granicą</option>
                                            <option value="nieruchomosci">Nieruchomości</option>
                                            <option value="inne">Inne</option>
                                        </select>
                                    </div>

                                    <!-- created_by -->
                                    <div class="mb-3">
                                        <select 
                                            class="form-select dark-mode mb-2 mt-2" 
                                            style="max-height: 30px; font-size: 12px;" 
                                            id="created_by_9999999" 
                                            name="created_by"
                                            required>

                                            <option value="">Wybierz profil FB</option>
                                            <option value="dmddomyy">DMD Domy</option>
                                            <option value="fredgraf">Fred Graf</option>
                                        </select>
                                    </div>
                                    

                                    <!-- moduł dropboxa -->
                                    <label class="form-label">Zdjęcia do ogłoszenia</label>
                                    <div id="9999999-drop-area" class="drop-area">
                                        <h3>Przeciągnij (max 10) zdjęcia tutaj</h3>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label ms-5">Pliki do wysłania:</label>
                                        <ul id="9999999-fileList" class="list-group ms-5 me-5"></ul>
                                    </div>
                                    <script>
                                        document.addEventListener('DOMContentLoaded', () => {
                                            const myFotoDropBox = new FotoDropBox('9999999');
                                        });
                                    </script>
                                    <input type="hidden" name="OfferID" id="OfferID_9999999" value="9999999"/>
                                    
                                    <input type="hidden" name="author" id="author_9999999" value="{{username}}"/>
                                    <input type="hidden" name="target" id="target_9999999" value="anonymous"/>
                                    <!-- Przycisk Zapisz artykuł -->
                                    <button 
                                        type="button" 
                                        class="btn btn-success btn-sm" 
                                        style="max-height: 30px; font-size: 12px;" 
                                        onclick="prepareAndSubmitHiddenFBform('9999999', false)"
                                    >
                                        Dodaj kampanię anonimową
                                    </button>
                                </form>
                            </div>
                        </div>

                        {% for post_data in ads_hidden_campaigns %}
                            {% set post_id  = post_data['ID'] %}
                            <!-- linia contentu tabeli ciemna-->
                            <div>
                                <div class="row klej {% if loop.index is even %}formatuj-light-line{% else %}formatuj-dark-line{% endif %}" >
                                    <div class="d-none d-lg-block formatuj-maly-font" style="max-width: 30px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        {{post_id}}
                                    </div>
                                    <div class="d-lg-none" style="max-width: 30px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        {% if post_data['status'] == 1 %}
                                            <span class="d-block d-lg-none formatuj-maly-font"> <i class="bi bi-lightbulb-fill text-warning"></i></span>
                                        {% else %}
                                            <span class="d-block d-lg-none formatuj-maly-font"> <i class="bi bi-lightbulb-fill text-secondary"></i></span>
                                        {% endif %}
                                    </div>
                                    <div  class="col-xl-8 col-md-8 col-sm-10 formatuj-maly-font" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        <a data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                            {{post_data['title']}}
                                        </a>
                                        
                                    </div>
                                    <div  class="d-none d-lg-block"  style="max-width: 120px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        <a data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                            <span class="display-6 formatuj-maly-font">{{post_data['author']}}</span>
                                        </a>
                                    </div>
                                    <div  class="d-none d-xl-block"  style="max-width: 150px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        <a data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                            <span class="display-6 formatuj-maly-font">{{post_data['category'][:12]}}</span>
                                        </a>
                                    </div>
                                    <div  class="d-none d-lg-block" style="max-width: 120px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        <a data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                            {% if post_data['status'] == 1 %}
                                                <span class="text-warning">Aktywna</span>
                                            {% else %}
                                                <span class="text-secondary">Nieaktywna</span>
                                            {% endif %}
                                        </a>
                                    </div>
                                    <div  class="d-none d-xl-block" style="max-width: 250px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        <div class="row">
                                            <!-- FaceBook Groups -->
                                            {% set ns = namespace(last_action_index=None, last_action_status=None, last_action_planned=None) %}

                                            <!-- Szukanie ostatniej wykonanej akcji i zliczanie zaplanowanych akcji -->
                                            {% for i in range(11) %}
                                                {% set schedule_datetime = post_data['fbgroups']['schedule_' ~ i ~ '_datetime'] %}
                                                {% set schedule_status = post_data['fbgroups']['schedule_' ~ i ~ '_status'] %}
                                                                                            
                                                <!-- Sprawdzenie, czy akcja jest zaplanowana (ma datę) -->
                                                {% if schedule_datetime is not none and schedule_datetime != '' %}
                                                    {% set ns.last_action_planned = i %}
                                                {% endif %}

                                                <!-- Sprawdzenie, czy akcja ma status różny od None i jest wykonana -->
                                                {% if schedule_status is not none and schedule_status != '' %}
                                                    {% set ns.last_action_index = i %}
                                                    {% set ns.last_action_status = schedule_status %}
                                                {% endif %}
                                            {% endfor %}

                                            <!-- Wyświetlanie odpowiedniej ikonki dla ostatnio wykonanej akcji -->
                                            {% if ns.last_action_status is not none and ns.last_action_status != '' %}
                                                <div class="col-1 me-1">
                                                    {% if ns.last_action_status == 1 %}
                                                        {% if ns.last_action_index < ns.last_action_planned %}
                                                            <div class="ico-facebookgroups-active"></div>
                                                            {% else %}
                                                            <div class="ico-facebookgroups-warning"></div>
                                                        {% endif %}
                                                    {% elif ns.last_action_status == 2 %}
                                                        <div class="ico-facebookgroups-error"></div>
                                                    {% elif ns.last_action_status == 4 %}
                                                        <div class="ico-facebookgroups-inprogress"></div>
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="d-none d-lg-block" style="max-width: 150px;" data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                        <a data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}">
                                            <span class="display-6 formatuj-maly-font">{{post_data['data']}}</span>
                                        </a>
                                    </div>
                                    <div class="text-end" style="max-width: 80px;">
                                        
                                        <form method="POST" id="remove_hidden_campaigns_{{post_id}}" action="{{ url_for('remove_hidden_campaigns') }}" enctype="multipart/form-data" onsubmit="return confirm('Uwaga: Przed usunięciem kampanii upewnij się, że nie jest zaplanowana! Czy na pewno chcesz usunąć ofertę?');">

                                            <a data-bs-toggle="collapse" href="#collapse_id_{{post_id}}" role="button" aria-expanded="false" aria-controls="collapse_id_{{post_id}}"><i class="bi bi-chevron-double-down" style="color: rgb(89, 176, 90) !important;"></i></a>

                                            <a data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling_{{post_id}}" aria-controls="offcanvasScrolling_{{post_id}}"><i class="bi bi-pencil" style="color: #7eb5cc !important;"></i></a>
                                            <input type="hidden" name="UserName" id="UserName_{{post_id}}" value="{{username}}"/>
                                            <input type="hidden" name="PostID" id="PostID_{{post_id}}" value="{{post_id}}"/>
                                            <button type="submit" class="custom-icon-button"><i class="bi bi-trash-fill" style="color: rgb(149, 47, 47) !important;"></i></button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <!-- offcanvanse left -->
                            <div class="offcanvas offcanvas-start bg-dark oc-width" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling_{{post_id}}" aria-labelledby="offcanvasScrollingLabel">
                                <div class="offcanvas-header">
                                <h4 class="offcanvas-title" id="offcanvasScrollingLabel">Edycja Kampanii Anonimowej o id: {{post_id}}</h4>
                                <button type="button" class="btn-close btn-close-white"  data-bs-dismiss="offcanvas" aria-label="Close"></button>
                                </div>
                                <div class="offcanvas-body formatuj-maly-font">
                                    <div class="tylko-klej">
                                        <div style="color:#6a6a6a;">
                                            <form method="POST" id="hiddencampaigns_{{post_id}}" action="{{ url_for('save_hidden_campaigns') }}" enctype="multipart/form-data" >
                                                <!-- title -->
                                                <div class="form-floating mb-3">
                                                    <input 
                                                        type="text" 
                                                        value="{{post_data['title']}}"
                                                        class="form-control bg-dark formatuj-maly-font" 
                                                        style="color:#c2c2c2; border:#6a6a6a solid 1px;"
                                                        id="title_{{post_id}}" 
                                                        name="title" 
                                                        placeholder="Tytuł Kampanii"
                                                        required />
                                                    <label for="title_{{post_id}}">Tytuł Kampanii</label>
                                                </div>
                                                <!-- description -->
                                                <label class="form-label mt-2">Treść ogłoszenia</label>
                                                <div 
                                                    id="description_{{post_id}}" 
                                                    contenteditable="true" 
                                                    class="form-control bg-dark formatuj-maly-font" 
                                                    style="color:#c2c2c2; border:#6a6a6a solid 1px; padding:10px; min-height:100px;">{{post_data['description']}}</div>
                                                <div class="no-border formatuj-maly-font fadeIn mb-3">
                                                    <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_{{post_id}}', 'Szukamy [stanowisko]. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                                        Szablon Ogólny
                                                    </a>
                                                    <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_{{post_id}}', 'Szukamy [stanowisko] z doświadczeniem w branży minimum [ilość lat] lat. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                                        Szablon Zadaniowiec
                                                    </a>
                                                    <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_{{post_id}}', 'Szukamy Lidera Zespołu [rodzaj zespołu] z doświadczeniem w zarządzaniu. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                                        Szablon Lider Zespołu
                                                    </a>
                                                    <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_{{post_id}}', 'Szukamy Eksperta Specjalistycznego w dziedzinie [dziedzina]. Oferujemy [warunki zatrudnienia]. Kontakt: [forma kontaktu].');">
                                                        Szablon Ekspert Specjalistyczny
                                                    </a>
                                                    <a class="ms-2" href="javascript:void(0);" onClick="applyTemplate('description_{{post_id}}', 'Szukamy ekipy budowlanej z doświadczeniem. Oferujemy stałe zlecenia, dobre wynagrodzenie. Kontakt: [forma kontaktu].');">
                                                        Szablon Ekipa Budowlana
                                                    </a>
                                                </div>
                                                
                                                <!-- category -->
                                                <div class="mb-3">
                                                    <select 
                                                        class="form-select dark-mode mb-2 mt-2" 
                                                        style="max-height: 30px; font-size: 12px;" 
                                                        id="category_{{post_id}}" 
                                                        name="category"
                                                        required>

                                                        <option value="">Kategoria grupy</option>
                                                        <option value="praca" {{ 'selected' if post_data['category'] == 'praca' else '' }}>Praca</option>
                                                        <option value="budowy" {{ 'selected' if post_data['category'] == 'budowy' else '' }}>Budowy</option>
                                                        <option value="murarze" {{ 'selected' if post_data['category'] == 'murarze' else '' }}>Murarze</option>
                                                        <option value="domy" {{ 'selected' if post_data['category'] == 'domy' else '' }}>Budowa domów</option>
                                                        <option value="ciesle" {{ 'selected' if post_data['category'] == 'ciesle' else '' }}>Cieśle</option>
                                                        <option value="szalunkowcy" {{ 'selected' if post_data['category'] == 'szalunkowcy' else '' }}>Szalunkowcy</option>
                                                        <option value="dekarze" {{ 'selected' if post_data['category'] == 'dekarze' else '' }}>Dekarze</option>
                                                        <option value="ocieplenia" {{ 'selected' if post_data['category'] == 'ocieplenia' else '' }}>Ocieplenia</option>
                                                        <option value="ekipy" {{ 'selected' if post_data['category'] == 'ekipy' else '' }}>Ekipy budowlane</option>
                                                        <option value="zagranica" {{ 'selected' if post_data['category'] == 'zagranica' else '' }}>Praca za granicą</option>
                                                        <option value="inne" {{ 'selected' if post_data['category'] == 'inne' else '' }}>Inne</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- created_by -->
                                                <div class="mb-3">
                                                    <select 
                                                        class="form-select dark-mode mb-2 mt-2" 
                                                        style="max-height: 30px; font-size: 12px;" 
                                                        id="created_by_{{post_id}}" 
                                                        name="created_by"
                                                        required>

                                                        <option value="">Wybierz profil FB</option>
                                                        <option value="dmddomyy" {{ 'selected' if post_data['created_by'] == 'dmddomyy' else '' }}>DMD Domy</option>
                                                        <option value="fredgraf" {{ 'selected' if post_data['created_by'] == 'fredgraf' else '' }}>Fred Graf</option>
                                                    </select>
                                                </div>
            
                                                <!-- moduł dropboxa -->
                                                <label class="form-label">Zdjęcia Nieruchomości</label>
                                                <div id="{{post_id}}-drop-area" class="drop-area">
                                                    <h3>Przeciągnij (max 10) zdjęcia tutaj</h3>
                                                </div>
            
                                                <div class="mb-3">
                                                    <label class="form-label ms-5">Pliki do wysłania:</label>
                                                    <ul id="{{post_id}}-fileList" class="list-group ms-5 me-5"></ul>
                                                </div>
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', () => {
                                                        const myFotoDropBox = new FotoDropBox('{{post_id}}', 
                                                        [
                                                            //{% for foto in post_data['photos'] %}
                                                            "{{foto}}",
                                                            //{% endfor %}
                                                        ]
                                                        );
                                                    });
                                                </script>
                                                
                                                <input type="hidden" name="OfferID" id="OfferID_{{post_id}}" value="{{post_id}}"/>
                                                
                                                <input type="hidden" name="author" id="author_{{post_id}}" value="{{username}}"/>
                                                <input type="hidden" name="target" id="target_{{post_id}}" value="{{post_data['target']}}"/>

                                                <!-- Przycisk Zapisz artykuł -->
                                                <button 
                                                    type="button" 
                                                    class="btn btn-success btn-sm" 
                                                    style="max-height: 30px; font-size: 12px;" 
                                                    onclick="prepareAndSubmitHiddenFBform('{{post_id}}', true)"
                                                >
                                                    Zapisz kampanię anonimową
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                            <!-- collapse start -->

                            <div class="sub-panel rogi collapse formatyj-maly-wiersz p-2" id="collapse_id_{{post_id}}">

                                <div class="row">
                                    <div class="col-lg-5 col-sm-12">
                                        {% if post_data['photos'] %}
                                        <img src="{{post_data['photos'][0]}}" alt="" class="img-thumbnail object-fit-cover rounded bg-dark mb-2" >
                                            {% if len(post_data['photos']) > 1 %}
                                            <div class="row row-cols-4">
                                                {% for foto in post_data['photos'][1:] %}
                                                <div class="col mb-1">
                                                    <img src="{{foto}}" alt="" class="img-thumbnail object-fit-cover rounded bg-dark" >
                                                </div>
                                                {% endfor %}
                                            </div>
                                            {% endif %}
                                        {% endif %}
                                        
                                        <div class="career-properties">
                                            <form action="{{ url_for('update_hidden_campaigns_status') }}" method="POST" enctype="multipart/form-data">
                                                <input type="hidden" name="PostID" value="{{post_id}}" />
                                                {% if post_data['status'] == 1 %}
                                                    <div class="col me-1 mb-1">
                                                        <input type="hidden" name="Status" value="0" />
                                                        <button type="submit" class="btn btn-outline-danger btn-sm" style="max-height: 30px; font-size: 12px;" onclick>Dezaktywuj</button>
                                                    </div>
                                                {% else %}
                                                    <div class="col me-1 mb-1">
                                                        <input type="hidden" name="Status" value="1" />
                                                        <button type="submit" class="btn btn-outline-success btn-sm" style="max-height: 30px; font-size: 12px;" onclick>Aktywuj</button>
                                                    </div>
                                                {% endif %}
                                            </form>
                                        </div>
                                    </div>
                                    <div class="col-lg-7 col-sm-12 career-properties-other">
                                        <h5>Opis Kampanii</h5>
                                        <p>{{post_data['description']}}</p>
                                        <p>Autor: {{post_data['author']}}</p>
                                        <p>Kategoria: {{post_data['category']}}</p>
                                    </div>
                                </div>
                                {% if post_data['status'] != 0 %}
                                    {% if post_data['fbgroups']['id'] == None %}
                                    <form action="" id="form_hiddenFB_{{post_id}}" method="POST" enctype="multipart/form-data">
                                        <div class="row">
                                            <div class="col-lg-5 col-sm-12">
                                                <div class="mb-2 mt-2">
                                                    <h5>Treść Ogłoszenia na Grupach FB</h5>
                                                </div>
                                                <div 
                                                    id="fbgroups_requirementsDescription_{{post_id}}" 
                                                    class="fbgroups-requirements-description content-editable formatuj-maly-font" 
                                                    contenteditable="true">{{post_data['description']}}<div id="char_count_{{post_id}}" class="char-count"></div></div>

                                                <!-- Ukryte pole do przechowywania wartości wybranego koloru -->
                                                <input type="hidden" id="color_choice_{{post_id}}" name="color_choice" value="0">
                                                
                                                <!-- Div dla opcji wyświetlanych w zależności od liczby znaków -->
                                                <div class="minus130" id="fbgroup_minus130_{{post_id}}" style="display: none;">
                                                    <div class="no-border formatuj-maly-font fadeIn mb-3">
                                                        <a 
                                                            class="ms-2" 
                                                            href="javascript:void(0);" 
                                                            onClick="applyTemplate('fbgroups_requirementsDescription_{{post_id}}', `Szukamy {{post_data['title']}}! Dołącz do naszego zespołu DMD. Więcej info na DM`);">
                                                            Dołącz do naszego zespołu
                                                        </a>
                                                        <a 
                                                            class="ms-2" 
                                                            href="javascript:void(0);" 
                                                            onClick="applyTemplate('fbgroups_requirementsDescription_{{post_id}}', `{{post_data['brand']}} poszukuje {{post_data['title']}}. Kontakt: {{post_data['contact_email']}}`);">
                                                            DMD poszukuje
                                                        </a>
                                                        <a 
                                                            class="ms-2" 
                                                            href="javascript:void(0);" 
                                                            onClick="applyTemplate('fbgroups_requirementsDescription_{{post_id}}', `Zatrudnimy na stanowisko {{post_data['title']}} w {{post_data['brand']}}! Szczegóły na DM`);">
                                                            Zatrudnimy na stanowisko
                                                        </a>
                                                    </div>
                                                    <!-- Divy dla wyboru koloru -->
                                                    <div class="color-picker" id="color_picker_minus130_{{post_id}}">
                                                        <div class="color-box" data-color="0" id="color_box_0_{{post_id}}" style="background-color: transparent;"></div> <!-- Opcja bez wypełnienia -->
                                                        <div class="color-box" data-color="1" id="color_box_1_{{post_id}}" style="background-image: url('static/img/fb-short-1.png');"></div>
                                                        <div class="color-box" data-color="2" id="color_box_2_{{post_id}}" style="background-image: url('static/img/fb-short-2.png');"></div>
                                                        <div class="color-box" data-color="3" id="color_box_3_{{post_id}}" style="background-image: url('static/img/fb-short-3.png');"></div>
                                                        <div class="color-box" data-color="4" id="color_box_4_{{post_id}}" style="background-image: url('static/img/fb-short-4.png');"></div>
                                                        <div class="color-box" data-color="5" id="color_box_5_{{post_id}}" style="background-image: url('static/img/fb-short-5.png');"></div>
                                                        <div class="color-box" data-color="6" id="color_box_6_{{post_id}}" style="background-image: url('static/img/fb-short-6.png');"></div>
                                                        <div class="color-box" data-color="7" id="color_box_7_{{post_id}}" style="background-image: url('static/img/fb-short-7.png');"></div>
                                                    </div>
                                                </div>

                                                <div class="more130" id="fbgroup_more130_{{post_id}}" style="display: none;">
                                                    <!-- Divy dla wyboru koloru -->
                                                    <div class="color-picker" id="color_picker_more130_{{post_id}}">
                                                        <div class="color-box" data-color="0" id="color_box_0_{{post_id}}" style="background-color: transparent;"></div> <!-- Opcja bez wypełnienia -->
                                                        <div class="color-box" data-color="8" id="color_box_8_{{post_id}}" style="background-image: url('static/img/fb-short-8.png');"></div>
                                                        <div class="color-box" data-color="9" id="color_box_9_{{post_id}}" style="background-image: url('static/img/fb-short-9.png');"></div>
                                                    </div>
                                                </div>

                                                <!-- Skrypt do uruchomienia dla każdego posta -->
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', function () {
                                                        new CharCounterCheckGallery('{{post_id}}');
                                                        }
                                                    );
                                                </script>

                                            </div>
                                            <div class="col-lg-3 col-sm-12">
                                                <div> 
                                                    
                                                    <div class="mb-2 mt-2">
                                                        <h5>FACEBOOK GRUPY</h5>
                                                        
                                                        <p>Status: Pierwsza publikacja na grupach facebook</p>
                                                    </div>

                                                    <div class="row row-cols-auto mb-3">
                                                        <div class="col">
                                                                <input type="hidden" id="category_{{post_id}}" name="category" value="{{post_data['category']}}" />
                                                                <input type="hidden" id="section_{{post_id}}" name="section" value="hiddeCampaigns" />
                                                                <input type="hidden" id="id_gallery_{{post_id}}" name="id_gallery" value="{{post_data['id_gallery']}}" />

                                                                <div class="col me-1 mb-1">
                                                                    
                                                                    <input type="hidden" name="Status" value="0" />
                                                                    <input type="hidden" name="task_kind" value="Publikuj" />
                                                                    

                                                                    <!-- block -->
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <div class="form-check form-switch">
                                                                                <input class="form-check-input" type="checkbox" role="switch" id="wznawiaj_{{post_id}}" name="wznawiaj">
                                                                                <label class="form-check-label" for="wznawiaj_{{post_id}}">Wznawiaj ogłoszenie automatycznie</label>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <!-- block -->
                                                                            <div class="row">
                                                                                <div class="col">
                                                                                    Częstotliwość co:
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="codwatygodnie_{{post_id}}" name="codwatygodnie" value="1" checked>
                                                                                        <label class="form-check-label" for="codwatygodnie_{{post_id}}">14 dni</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="cotydzien_{{post_id}}" name="cotydzien" value="1" >
                                                                                        <label class="form-check-label" for="cotydzien_{{post_id}}">7 dni</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="coczterydni_{{post_id}}" name="coczterydni" value="1">
                                                                                        <label class="form-check-label" for="coczterydni_{{post_id}}">4 dni</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="codwadni_{{post_id}}" name="codwadni" value="1">
                                                                                        <label class="form-check-label" for="codwadni_{{post_id}}">2 dni</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="row">
                                                                        <div class="col">
                                                                            <!-- block -->
                                                                            <div class="row">
                                                                                <div class="col">
                                                                                    Iloś ponowień:
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="ponow2razy_{{post_id}}" name="ponow2razy" value="1" checked>
                                                                                        <label class="form-check-label" for="ponow2razy_{{post_id}}">x 2</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="ponow5razy_{{post_id}}" name="ponow5razy" value="1" >
                                                                                        <label class="form-check-label" for="ponow5razy_{{post_id}}">x 5</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            <div class="row">
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="ponow8razy_{{post_id}}" name="ponow8razy" value="1">
                                                                                        <label class="form-check-label" for="ponow8razy_{{post_id}}">x 8</label>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="col">
                                                                                    <div class="form-check form-switch">
                                                                                        <input class="form-check-input" type="checkbox" role="switch" id="ponow10razy_{{post_id}}" name="ponow10razy" value="1">
                                                                                        <label class="form-check-label" for="ponow10razy_{{post_id}}">x 10</label>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>


                                                                    <button type="button" class="btn btn-outline-info btn-sm" style="max-height: 30px; font-size: 12px;" onclick="collectAndSendHiddenFBform('{{post_id}}')"> 
                                                                        Publikuj grupach
                                                                    </button>
                                                                    <div class="form-message mt-3" id="komunikat_z_serwera_{{post_id}}"></div>
                                                                </div>
                                                            
                                                        </div>
                                                    </div>
                                                    <script>
                                                        document.addEventListener('DOMContentLoaded', function(){
                                                            checkboxControlDisable(
                                                                'hiddenFB_{{post_id}}', 
                                                                'wznawiaj_{{post_id}}', 
                                                                [
                                                                    'codwatygodnie_{{post_id}}', 
                                                                    'cotydzien_{{post_id}}', 
                                                                    'coczterydni_{{post_id}}', 
                                                                    'codwadni_{{post_id}}',
                                                                    'ponow2razy_{{post_id}}',
                                                                    'ponow5razy_{{post_id}}',
                                                                    'ponow8razy_{{post_id}}',
                                                                    'ponow10razy_{{post_id}}'
                                                                ]
                                                            );

                                                            checkboxControlEnabled(
                                                                'hiddenFB_{{post_id}}', 
                                                                'wznawiaj_{{post_id}}', 
                                                                [
                                                                    'codwatygodnie_{{post_id}}', 
                                                                    'cotydzien_{{post_id}}', 
                                                                    'coczterydni_{{post_id}}',
                                                                    'codwadni_{{post_id}}',
                                                                    'ponow2razy_{{post_id}}',
                                                                    'ponow5razy_{{post_id}}',
                                                                    'ponow8razy_{{post_id}}',
                                                                    'ponow10razy_{{post_id}}'
                                                                ]
                                                            );

                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'codwatygodnie_{{post_id}}', 
                                                                [
                                                                    'cotydzien_{{post_id}}',
                                                                    'coczterydni_{{post_id}}',
                                                                    'codwadni_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'cotydzien_{{post_id}}', 
                                                                [
                                                                    'codwatygodnie_{{post_id}}',
                                                                    'coczterydni_{{post_id}}',
                                                                    'codwadni_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'coczterydni_{{post_id}}', 
                                                                [
                                                                    'codwatygodnie_{{post_id}}',
                                                                    'cotydzien_{{post_id}}',
                                                                    'codwadni_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'codwadni_{{post_id}}', 
                                                                [
                                                                    'codwatygodnie_{{post_id}}',
                                                                    'cotydzien_{{post_id}}',
                                                                    'coczterydni_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'ponow2razy_{{post_id}}', 
                                                                [
                                                                    'ponow5razy_{{post_id}}',
                                                                    'ponow8razy_{{post_id}}',
                                                                    'ponow10razy_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'ponow5razy_{{post_id}}', 
                                                                [
                                                                    'ponow2razy_{{post_id}}',
                                                                    'ponow8razy_{{post_id}}',
                                                                    'ponow10razy_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'ponow8razy_{{post_id}}', 
                                                                [
                                                                    'ponow2razy_{{post_id}}',
                                                                    'ponow5razy_{{post_id}}',
                                                                    'ponow10razy_{{post_id}}'
                                                                ]
                                                            );
                                                            checkboxControlOffOther(
                                                                'hiddenFB_{{post_id}}', 
                                                                'ponow10razy_{{post_id}}', 
                                                                [
                                                                    'ponow2razy_{{post_id}}',
                                                                    'ponow5razy_{{post_id}}',
                                                                    'ponow8razy_{{post_id}}'
                                                                ]
                                                            );
                                                            
                                                        });
                                                        
                                                    </script>

                                                </div>
                                            </div>
                                            <div class="col-lg-3 col-sm-12">
                                                <div id="fbgroups_shedule_{{post_id}}" class="schedule-output"></div>
                                                <script>
                                                    document.addEventListener('DOMContentLoaded', function(){
                                                        setupSchedule('{{post_id}}');
                                                    });
                                                </script>
                                            </div>
                                        </div>
                                    </form>
                                    {% else %}
                                    <form method="POST" id="remove_hidden_campaigns_{{post_id}}" action="{{ url_for('remove_hidden_campaigns') }}" enctype="multipart/form-data" onsubmit="return confirm('Uwaga: Czy na pewno chcesz zatrzymać tę kampanię na grupach facebooka?');">
                                        <div class="row">
                                            <div class="col-lg-12 col-sm-12 mb-3 mt-3">
                                                <h3>Monitoring Kampanii Na grupach FB</h3>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-lg-5">
                                                <div class="row">
                                                    <div class="col-12 mb-3">
                                                        <h5>Podgląd Posta</h5>
                                                    </div>
                                                </div>
                                                <div class="fbgroups-requirements-description-preview-{{post_data['fbgroups']['color_choice']}}">
                                                    {{ post_data['fbgroups']['content'] }}
                                                </div>
                                            </div>
                                            <div class="col-lg-5">
                                                <div class="">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <h5>Harmonogram</h5>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        {% for i in range(11) %}
                                                            {% set schedule_datetime = post_data['fbgroups']['schedule_' ~ i ~ '_datetime'] %}
                                                            {% set schedule_status = post_data['fbgroups']['schedule_' ~ i ~ '_status'] %}
                                                            {% set schedule_errors = post_data['fbgroups']['schedule_' ~ i ~ '_errors'] %}
                                                            {% if schedule_datetime %}
                                                                <div class="col-3 mb-3 mt-3">
                                                                    <div class="checkpoint
                                                                                {% if schedule_status == 1 %}completed{% elif schedule_status == 4 %}in-progress
                                                                                {% elif schedule_status == 2 %}error{% else %}waiting{% endif %}">
                                                                        <p>
                                                                            {% if schedule_status == 1 %}
                                                                                <!-- Zrealizowane bez błędów -->
                                                                                <span class="completed-icon">
                                                                                    <i class="bi bi-check-circle"></i>
                                                                                </span>
                                                                            {% elif schedule_status == 4 %}
                                                                                <!-- W trakcie realizacji -->
                                                                                <span class="in-progress-icon">
                                                                                    <i class="bi bi-hourglass-split "></i>
                                                                                </span>
                                                                            {% elif schedule_status == 2 %}
                                                                                <!-- Zrealizowane z błędami -->
                                                                                <span class="error-icon">
                                                                                    <i class="bi bi-exclamation-triangle"></i>
                                                                                </span>
                                                                            {% else %}
                                                                                <!-- Oczekuje -->
                                                                                <span class="waiting-icon">
                                                                                    <i class="bi bi-clock"></i>
                                                                                </span>
                                                                            {% endif %}
                                                                        </p>
                                                                        <div class=" squerecircle mb-1">
                                                                            <span class="checkpoint-date">{{ schedule_datetime.strftime('%Y-%m-%d %H:%M') }}</span>
                                                                        </div>
                                                                        <div class="mb-1">
                                                                            <span class="checkpoint-date">{% if schedule_errors %}{{ schedule_errors }}{% endif %}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                {% if post_data['fbgroups']['schedule_' ~ i ~ '_id'] %}
                                                                    <input type="hidden" value="{{post_data['fbgroups']['schedule_' ~ i ~ '_id']}}" name="schedule_{{i}}_id" id="schedule_id_{{i}}_{{post_id}}"/>
                                                                {% endif %}
                                                            {% endif %}
                                                        {% endfor %}
                                                    </div>
                                                </div>
                                                <div class="mt-30">
                                                    <input type="hidden" value="{{post_data['fbgroups']['id']}}" name="waitnig_list_id" id="waitnig_list_id_{{post_id}}"/>
                                                    <input type="hidden" id="section_{{post_id}}" name="section" value="hiddeCampaigns" />
                                                    <button type="submit" class="btn btn-outline-warning btn-sm" style="max-height: 30px; font-size: 12px;" onclick>Zatrzymaj Kampanię</button>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                    {% endif %}

                                {% endif %}
                            </div>

                            <!-- collapse end -->
                        {% endfor %}
                        <!-- Paginacja -->
                        <span class="formatuj-maly-logout">{{ pagination.info }}</span>
                        <div class="pagination formatuj-margin-top">
                            <nav aria-label="Page navigation example">                            
                                <ul class="pagination justify-content-center dark-mode">
                                    <li class="page-item">{{ pagination.prev }}</li>
                                    <li class="page-item">{{ pagination.links }}</li>
                                    <li class="page-item">{{ pagination.next }}</li>
                                </ul>
                            </nav>
                        </div>
{% endblock %}
{% block bottom_script %}
<!-- sortowanie listy zdjęć dropbox estate -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.14.0/Sortable.min.js"></script>
<script>
    class FotoDropBox { // v 2.1
        constructor(formId, existingImageUrls = []) {
            if (!this.checkDragAndDropSupport()) {
                alert('Przeglądarka nie obsługuje funkcji przeciągania i upuszczania plików.');
                return;
            }

            this.dropArea = document.getElementById(`${formId}-drop-area`);
            this.fileList = document.getElementById(`${formId}-fileList`);
            this.accumulatedFiles = [];
            this.accounter_accumulatedFiles = 0;
            // v 2.1
            this.existingImageUrls = existingImageUrls;

            // v 2.0
            this.fileInput = document.createElement('input');
            this.fileInput.type = 'file';
            this.fileInput.multiple = true; // jeśli chcesz obsługiwać wiele plików naraz
            this.fileInput.style.display = 'none'; // ukryj element input
            document.body.appendChild(this.fileInput); // dodaj input do DOM
            this.dropArea.addEventListener('click', () => this.fileInput.click()); // po kliknięciu na dropArea, aktywuj input file
            this.fileInput.addEventListener('change', (e) => this.handleFileInput(e)); // obsługa zdarzenia change
            // v 2.0
            this.initEventListeners();
            // v 2.1
            this.loadExistingImages();
        }

        loadExistingImages() {
            this.existingImageUrls.forEach((url, index) => {
                this.accounter_accumulatedFiles += 1;
                const li = document.createElement('li');
                const img = document.createElement('img');
                img.src = url;
                img.style.height = '50px';
                img.style.marginRight = '10px';
                img.classList.add('img-thumbnail', 'object-fit-cover', 'rounded', 'bg-dark');
                li.appendChild(img);

                const fileName = url.slice(url.lastIndexOf('/') + 1);
                li.appendChild(document.createTextNode(fileName)); // Wyświetlanie nazwy pliku z URL
                li.style.color = '#fff';

                const closeButton = document.createElement('button');
                closeButton.classList.add('drop-box-close-button', 'btn-close', 'btn-close-white', 'float-end');
                closeButton.setAttribute('aria-label', 'Close');
                closeButton.addEventListener('click', () => this.removeFileFromURL(index, url));
                li.appendChild(closeButton);

                li.classList.add('list-group-item', 'formatuj-bg-dropbox-list');
                this.fileList.appendChild(li);
            });
            // ver. 2.4
            // Inicjalizacja Sortable po załadowaniu istniejących obrazów
            this.initSortable();
        }

        removeFileFromURL(index, url) {
            // Możesz dodać logikę do usuwania obrazu z serwera lub z aktualnej listy zdjęć
            this.existingImageUrls.splice(index, 1); // Usuń URL z listy
            this.accounter_accumulatedFiles -= 1;
            this.displayFiles(); // Odśwież wyświetlaną listę
        }
  
        checkDragAndDropSupport() {
            const div = document.createElement('div');
            return ('draggable' in div) || ('ondragstart' in div && 'ondrop' in div);
        }

        initEventListeners() {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                this.dropArea.addEventListener(eventName, (e) => this.preventDefaults(e), false);
            });

            ['dragenter', 'dragover'].forEach(eventName => {
                this.dropArea.addEventListener(eventName, () => this.highlight(), false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                this.dropArea.addEventListener(eventName, () => this.unhighlight(), false);
            });

            this.dropArea.addEventListener('drop', (e) => this.handleDrop(e), false);
        }

        preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        highlight() {
            this.dropArea.classList.add('highlight');
        }

        unhighlight() {
            this.dropArea.classList.remove('highlight');
        }

        handleDrop(e) {
            this.preventDefaults(e);
            let dt = e.dataTransfer;
            let files = dt.files;
            this.updateFileList(files);
        }
        
        handleDropImg(event) {
            event.preventDefault();
            let files = event.dataTransfer.files; // Pobierz pliki z obiektu DataTransfer
            let list = document.getElementById(formId + '-fileList');

            for (let i = 0; i < files.length; i++) {
                let file = files[i];
                let li = document.createElement('li');
                li.textContent = file.name + " (" + (file.size / 1024).toFixed(1) + " KB)"; // Dodaj informacje o pliku
                li.file = file; // Kluczowe: Przypisz obiekt File do elementu li
                list.appendChild(li);
            }
        }

        // Tuning po kliknieciu w dropbox tradycyjne okienko
        handleFileInput(e) {
            const files = e.target.files;
            this.updateFileList(files);
        }


        updateFileList(newFiles) {
            for (let file of newFiles) {
                if (this.accumulatedFiles.length >= 10 - this.accounter_accumulatedFiles) {
                    alert('Osiągnięto limit 10 plików.');
                    break;
                }
                if (!this.isFileUnique(file)) {
                    alert('Plik ' + file.name + ' jest już na liście.');
                    continue;
                }
                this.accumulatedFiles.push(file);
            }
            this.displayFiles();
        }

        isFileUnique(newFile) {
            return !this.accumulatedFiles.some(file => 
                file.name === newFile.name &&
                file.size === newFile.size &&
                this.getFileExtension(file.name) === this.getFileExtension(newFile.name)
            );
        }

        // ver. 2.4
        displayFiles() {
            this.fileList.innerHTML = '';  // Wyczyść istniejące wpisy
            this.loadExistingImages();

            this.accumulatedFiles.forEach((file, index) => {
                const li = document.createElement('li');
                li.file = file;  // Przypisz plik do elementu li dla łatwego dostępu

                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.onload = () => { URL.revokeObjectURL(img.src); };
                    img.style.height = '50px';
                    img.style.marginRight = '10px';
                    img.classList.add('img-thumbnail', 'object-fit-cover', 'rounded', 'bg-dark');
                    li.appendChild(img);
                } else {
                    alert('Plik ' + file.name + ' nie jest zdjęciem.');
                    return;  // Nie dodawaj plików, które nie są obrazami
                }

                li.appendChild(document.createTextNode(`${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB, ${this.getFileExtension(file.name)})`));
                if (file.size > 2097200) {
                    li.style.color = '#fd0f2b'; // czerwony, jeśli plik jest większy niż 2 MB
                } else if (file.size > 1048576) {
                    li.style.color = '#ff9900'; // pomarańczowy, jeśli plik jest większy niż 1 MB, ale mniejszy lub równy 2 MB
                } else {
                    li.style.color = '#00ff00'; // zielony, jeśli plik jest mniejszy niż 1 MB
                }
                li.classList.add('list-group-item', 'formatuj-bg-dropbox-list');
                this.fileList.appendChild(li);

                const closeButton = document.createElement('button');
                closeButton.classList.add('drop-box-close-button', 'btn-close', 'btn-close-white', 'float-end');
                closeButton.setAttribute('aria-label', 'Close');
                closeButton.addEventListener('click', () => this.removeFile(index));
                li.appendChild(closeButton);
            });

            // Zainicjuj Sortable.js po załadowaniu wszystkich elementów listy, nawet jeśli są tylko istniejące obrazy
            this.initSortable();
        }

        initSortable() {
            new Sortable(this.fileList, {
                animation: 150,
                onEnd: (evt) => {
                    // Zaktualizuj kolejność plików na podstawie nowej kolejności elementów listy
                    const newOrder = [];
                    this.fileList.querySelectorAll('li').forEach((li, index) => {
                        if (li.file) {
                            newOrder.push(li.file);
                        } else {
                            const imgIndex = Array.from(this.fileList.children).indexOf(li);
                            if (this.existingImageUrls[imgIndex]) {
                                newOrder.push(this.existingImageUrls[imgIndex]);
                            }
                        }
                    });
                    this.accumulatedFiles = newOrder.filter(file => typeof file !== 'string');  // Przechowuj tylko obiekty File
                    this.existingImageUrls = newOrder.filter(file => typeof file === 'string'); // Przechowuj tylko URL-e
                }
            });
        }

        
        removeFile(index) {
            this.accumulatedFiles.splice(index, 1); // Usuń element z tablicy
            this.displayFiles(); // Ponownie wyświetl listę plików bez usuniętego elementu
        }

        getFileExtension(filename) {
            return filename.slice((filename.lastIndexOf(".") - 1 >>> 0) + 2);
        }
    }

    // Funkcja do wypełnienia contenteditable
    function applyTemplate(elementId, value) {
        const element = document.getElementById(elementId);
        if (element && element.hasAttribute('contenteditable')) {
            // Kolorowanie nawiasów przy wypełnieniu szablonu
            const formattedValue = value.replace(/\[(.*?)\]/g, '<span style="color: #f39c12;">[$1]</span>');
            element.innerHTML = formattedValue; // Ustaw pokolorowaną zawartość
        }
    }

    // Funkcja do wypełniania contenteditable
    function fillContentEditable(elementId, value) {
        const element = document.getElementById(elementId);
        if (element && element.hasAttribute('contenteditable')) {
            element.innerHTML = value; // Ustaw wartość w contenteditable
        }
    }

    function fillInput(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
            element.value = value; // Przypisz wartość do elementu
        } else {
            console.error('Element o ID ' + elementId + ' nie istnieje.');
        }
    }

    
    function appendValueWithNewline(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
            element.value += value + '\n'; // Dodaj wartość i nową linię na końcu
        } else {
            console.error('Element o ID ' + elementId + ' nie istnieje.');
        }
    }

    

    class CharCounterCheckGallery {
        constructor(postId) {
            this.postId = postId;

            // Pobranie elementów dynamicznie na podstawie postId
            this.contentDiv = document.getElementById(`fbgroups_estateAdsRentDescription_${postId}`);
            this.charCountDiv = document.getElementById(`char_count_${postId}`);
            this.divMinus130 = document.getElementById(`fbgroup_minus130_${postId}`);
            this.divMore130 = document.getElementById(`fbgroup_more130_${postId}`);

            // Ukryty input dla koloru
            this.hiddenInput = document.getElementById(`color_choice_${postId}`);

            // Pobranie wszystkich boxów dla minus130 i more130
            this.colorPickerMinus130 = document.getElementById(`color_picker_minus130_${postId}`);
            this.colorPickerMore130 = document.getElementById(`color_picker_more130_${postId}`);

            // Nowy input do sprawdzenia galerii
            this.idGalleryInput = document.getElementById(`id_gallery_${postId}`);

            // Inicjalna aktualizacja licznika znaków
            this.updateCharCount();

            // Sprawdzenie, czy `id_gallery` jest None
            this.checkGallery();

            // Nasłuchiwanie zmian w treści contentEditable
            this.contentDiv.addEventListener('keyup', () => this.updateCharCount());
        }

        // Nowa metoda do sprawdzania id_gallery
        checkGallery() {
            const galleryValue = this.idGalleryInput.value;
            console.log(galleryValue);  // Sprawdź, jaka jest wartość

            // Jeśli galeria zawiera zdjęcia (wartość to liczba), to aktywuj more130
            if (galleryValue !== 'None' && galleryValue !== '') {
                this.divMore130.style.display = 'block';
                this.divMinus130.style.display = 'none';

                this.contentDiv.classList.remove('mainDiv-minus130');
                this.contentDiv.classList.add('mainDiv-more130');

                // Resetowanie zaznaczenia, gdy galeria zawiera zdjęcia
                this.resetColorSelection();
            }
        }

        // Metoda do resetowania zaznaczeń i ukrytego inputa
        resetColorSelection() {
            // Resetujemy wartość ukrytego inputa na 0
            this.hiddenInput.value = '0';

            // Usuwamy zaznaczenie (klasę 'selected') ze wszystkich boxów w obu pickerach
            const allColorBoxes = this.colorPickerMinus130.querySelectorAll('.color-box');
            const moreColorBoxes = this.colorPickerMore130.querySelectorAll('.color-box');

            // Usuwanie 'selected' z minus130
            allColorBoxes.forEach(box => box.classList.remove('selected'));

            // Usuwanie 'selected' z more130
            moreColorBoxes.forEach(box => box.classList.remove('selected'));
        }

        // Metoda do liczenia znaków i aktualizowania stanu
        updateCharCount() {
            const text = this.contentDiv.innerText || this.contentDiv.textContent;
            const charCount = text.length;

            // Aktualizacja licznika znaków
            this.charCountDiv.textContent = `${charCount} znaków`;

            // Przełączanie między trybami
            if (charCount > 1) {
                this.divMore130.style.display = 'block';
                this.divMinus130.style.display = 'none';

                // Dodajemy klasę dla więcej niż 130 znaków
                this.contentDiv.classList.remove('mainDiv-minus130');
                this.contentDiv.classList.add('mainDiv-more130');

                // Resetowanie zaznaczenia po przejściu do more130
                this.resetColorSelection();

            } else {
                this.divMore130.style.display = 'none';
                this.divMinus130.style.display = 'block';

                // Dodajemy klasę dla mniej niż 130 znaków
                this.contentDiv.classList.remove('mainDiv-more130');
                this.contentDiv.classList.add('mainDiv-minus130');

                // Resetowanie zaznaczenia po przejściu do minus130
                this.resetColorSelection();
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Pobranie wszystkich elementów typu color-picker
        const allPickers = document.querySelectorAll('.color-picker');
        
        allPickers.forEach(function(picker) {
            // Sprawdzenie, czy picker ma prawidłowe id
            if (!picker.id) {
                console.error('Color picker does not have a valid ID:', picker);
                return; // Pomiń, jeśli ID jest puste
            }

            // Wyciągnięcie post_id z identyfikatora pickera
            const idParts = picker.id.split('_');
            const postId = idParts.length > 2 ? idParts[3] : null; // Uzyskanie prawidłowego post_id

            // Sprawdzanie, czy postId jest prawidłowe
            if (!postId) {
                console.error('Post ID not found:', picker.id);
                return; // Pomiń, jeśli postId nie istnieje
            }

            // console.log('picker postId', picker.id, postId);

            // Pobranie ukrytego inputa dla tego postu
            const hiddenInput = document.getElementById(`color_choice_${postId}`);
            
            if (!hiddenInput) {
                console.error('Hidden input not found for postId:', postId);
                return; // Pomiń, jeśli ukryty input nie istnieje
            }

            // Pobranie wszystkich boxów wewnątrz danego picker-a
            const colorBoxes = picker.querySelectorAll('.color-box');
            
            colorBoxes.forEach(function(box) {
                box.addEventListener('click', function() {
                    // Usunięcie klasy 'selected' z każdego boxa w danym pickerze
                    colorBoxes.forEach(b => b.classList.remove('selected'));
                    
                    // Dodanie klasy 'selected' do wybranego boxa
                    box.classList.add('selected');
                    
                    // Ustawienie wartości ukrytego inputa na numer wybranego koloru
                    hiddenInput.value = box.getAttribute('data-color');
                });
            });
        });
    });


    function setupSchedule(postId) {
        const wznawiajSwitch = document.getElementById(`wznawiaj_${postId}`);
        const scheduleOutput = document.getElementById(`fbgroups_shedule_${postId}`);
        const freqSwitches = {
            "2": document.getElementById(`codwadni_${postId}`),
            "4": document.getElementById(`coczterydni_${postId}`),
            "7": document.getElementById(`cotydzien_${postId}`),
            "14": document.getElementById(`codwatygodnie_${postId}`)
        };
        const repeatSwitches = {
            "2": document.getElementById(`ponow2razy_${postId}`),
            "5": document.getElementById(`ponow5razy_${postId}`),
            "8": document.getElementById(`ponow8razy_${postId}`),
            "10": document.getElementById(`ponow10razy_${postId}`)
        };

        // Funkcja do generowania harmonogramu
        function generateSchedule() {
            const today = new Date();
            let schedule = '<div class="mb-2"><h5>HARMONOGRAM</h5></div>'; // Dodaj nagłówek na początku

            schedule += '<ul>'; // Tworzymy element ul

            if (!wznawiajSwitch.checked) {
                // Tylko jedna publikacja dzisiaj
                schedule += formatSchedule(today);
            } else {
                // Liczba powtórzeń
                const selectedRepeat = Object.keys(repeatSwitches).find(key => repeatSwitches[key]?.checked);
                const repeatCount = selectedRepeat ? parseInt(selectedRepeat) : 1;
                
                // Częstotliwość (co ile dni)
                const selectedFreq = Object.keys(freqSwitches).find(key => freqSwitches[key]?.checked);
                const frequency = selectedFreq ? parseInt(selectedFreq) : 1;

                // Generowanie harmonogramu
                for (let i = 0; i <= repeatCount; i++) {
                    const date = new Date(today);
                    date.setDate(today.getDate() + i * frequency);
                    schedule += formatSchedule(date);
                }
            }
            schedule += '</ul>'; // Zamykamy ul
            // console.log('schedule', schedule);
            scheduleOutput.innerHTML = schedule;
        }

        // Funkcja formatująca datę na czytelny format
        function formatSchedule(date) {
            const daysOfWeek = ["niedziela", "poniedziałek", "wtorek", "środa", "czwartek", "piątek", "sobota"];
            const months = ["styczeń", "luty", "marzec", "kwiecień", "maj", "czerwiec", "lipiec", "sierpień", "wrzesień", "październik", "listopad", "grudzień"];

            const dayOfWeek = daysOfWeek[date.getDay()];
            const dayOfMonth = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');

            // Tworzymy element listy z datą i godziną
            let formattedDate = `<li class="shedule-list-config"><i class="bi bi-compass" style="color: orange;"></i> ${dayOfWeek}`;

            if (date.getDate() === (new Date()).getDate()) {
                formattedDate += ' (dzisiaj)';
            }
            formattedDate += `</li><span class="shedule-date-details"> <i class="bi bi-three-dots-vertical" style="color: green;"></i> ${dayOfMonth} ${month} ${year} godzina ${hours}:${minutes}</span>`;

            return formattedDate;
        }

        // Nasłuchuj zmian na przełącznikach i generuj harmonogram
        wznawiajSwitch.addEventListener('change', generateSchedule);
        Object.values(freqSwitches).forEach(switchElement => switchElement?.addEventListener('change', generateSchedule));
        Object.values(repeatSwitches).forEach(switchElement => switchElement?.addEventListener('change', generateSchedule));

        // Inicjalne wyświetlenie harmonogramu
        generateSchedule();
    }

</script>
{% endblock %}
{% block footer %}
 To jest stopka panelu administracyjnego. All right reserved &copy; 2024 by DMD Panel Administratora.<br/>
{% endblock %}